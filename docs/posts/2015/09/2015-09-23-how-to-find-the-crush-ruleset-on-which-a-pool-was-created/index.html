<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Custom CRUSH rulesets and pools - The Child is Father of the Man</title><meta name="Description" content=""><meta property="og:title" content="Custom CRUSH rulesets and pools" />
<meta property="og:description" content="Ceph supports custom rulesets via CRUSH, which can be used to sort hardware based on various features such as speed and other factors, set custom weights, and do a lot of other useful things.
Pools, or the buckets were the data is written to, can be created on the custom rulesets, hence positioning the pools on specific hardware as per the administrator&rsquo;s need.
A large Ceph cluster may have lots of pools and rulesets specific for multiple use-cases." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://arvimal.github.io/posts/2015/09/2015-09-23-how-to-find-the-crush-ruleset-on-which-a-pool-was-created/" />
<meta property="article:published_time" content="2015-09-23T00:00:00+00:00" />
<meta property="article:modified_time" content="2015-09-23T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Custom CRUSH rulesets and pools"/>
<meta name="twitter:description" content="Ceph supports custom rulesets via CRUSH, which can be used to sort hardware based on various features such as speed and other factors, set custom weights, and do a lot of other useful things.
Pools, or the buckets were the data is written to, can be created on the custom rulesets, hence positioning the pools on specific hardware as per the administrator&rsquo;s need.
A large Ceph cluster may have lots of pools and rulesets specific for multiple use-cases."/>
<meta name="application-name" content="The Child is Father of the Man">
<meta name="apple-mobile-web-app-title" content="The Child is Father of the Man"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://arvimal.github.io/posts/2015/09/2015-09-23-how-to-find-the-crush-ruleset-on-which-a-pool-was-created/" /><link rel="prev" href="https://arvimal.github.io/posts/2015/09/2015-09-18-how-to-get-a-listing-of-the-osd-nodes-in-an-easily-scriptable-format/" /><link rel="next" href="https://arvimal.github.io/posts/2015/10/2015-10-07-objects-remain-in-a-ceph-pool-used-for-rbd-even-if-the-files-are-deleted-from-the-mount-point/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Custom CRUSH rulesets and pools",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/arvimal.github.io\/posts\/2015\/09\/2015-09-23-how-to-find-the-crush-ruleset-on-which-a-pool-was-created\/"
        },"genre": "posts","wordcount":  309 ,
        "url": "https:\/\/arvimal.github.io\/posts\/2015\/09\/2015-09-23-how-to-find-the-crush-ruleset-on-which-a-pool-was-created\/","datePublished": "2015-09-23T00:00:00+00:00","dateModified": "2015-09-23T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "Author"},"author": {
                "@type": "Person",
                "name": "Author"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="The Child is Father of the Man">The Child is Father of the Man</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="The Child is Father of the Man">The Child is Father of the Man</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Custom CRUSH rulesets and pools</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Author</a></span>&nbsp;<span class="post-category">included in <a href="/categories/ceph/"><i class="far fa-folder fa-fw"></i>ceph</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2015-09-23">2015-09-23</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;309 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;2 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents"></nav></div>
            </div><div class="content" id="content"><p>Ceph supports custom rulesets via <a href="http://ceph.com/papers/weil-crush-sc06.pdf" target="_blank" rel="noopener noreffer">CRUSH</a>, which can be used to sort hardware based on various features such as speed and other factors, set custom weights, and do a lot of other useful things.</p>
<p>Pools, or the buckets were the data is written to, can be created on the custom rulesets, hence positioning the pools on specific hardware as per the administrator&rsquo;s need.</p>
<p>A large Ceph cluster may have lots of pools and rulesets specific for multiple use-cases. There may be times when we&rsquo;d like to understand the pool to ruleset mapping.</p>
<p>The default CRUSH ruleset is named ‘replicated_ruleset’. The available CRUSH rulesets can be listed with:</p>
<blockquote>
<p><strong>$ ceph osd crush rule ls</strong></p>
</blockquote>
<p>On a fresh cluster, or one without any custom rulesets, you’d find the following being printed to stdout.</p>
<blockquote>
<p><strong># ceph osd crush rule ls</strong> [ &ldquo;replicated_ruleset&rdquo; ]</p>
</blockquote>
<p>I’ve got a couple more on my cluster, and this is how it looks:</p>
<blockquote>
<p><strong># ceph osd crush rule ls</strong> [ &ldquo;replicated_ruleset&rdquo;, &ldquo;replicated_ssd&rdquo;, &ldquo;erasure-code&rdquo;]</p>
</blockquote>
<p>Since this article looks into the mapping of pools to CRUSH rulesets, it’d be good to add in how to list the pools, as a refresher.</p>
<blockquote>
<p><strong># ceph osd lspools</strong></p>
</blockquote>
<p>On my Ceph cluster, it turned out to be:</p>
<blockquote>
<p><strong># ceph osd lspools</strong> 0 data,1 metadata,2 rbd,21 .rgw,22 .rgw.root,23 .rgw.control,24 .rgw.gc,25 .users.uid,26 .users,27 .users.swift,28 test_pool,</p>
</blockquote>
<p>Since you have the pool name you’re interested in, let’s see how to map it to the ruleset. The command syntax is:</p>
<blockquote>
<p><strong># ceph osd pool get &lt;pool_name&gt; crush_ruleset</strong></p>
</blockquote>
<p>I was interested to understand the ruleset on which the pool ‘test_pool’ was created. The command to list this was:</p>
<blockquote>
<p><strong># ceph osd pool get test_pool crush_ruleset</strong> crush_ruleset: 1</p>
</blockquote>
<p>Please note that the rulesets are numbered from ‘0’, and hence ‘1’ would map to the CRUSH ruleset ‘replicated_ssd’.</p>
<p>We&rsquo;ll try to understand how a custom ruleset is created, in another article.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2015-09-23</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/2015/09/2015-09-18-how-to-get-a-listing-of-the-osd-nodes-in-an-easily-scriptable-format/" class="prev" rel="prev" title="OSD information in a scriptable format"><i class="fas fa-angle-left fa-fw"></i>OSD information in a scriptable format</a>
            <a href="/posts/2015/10/2015-10-07-objects-remain-in-a-ceph-pool-used-for-rbd-even-if-the-files-are-deleted-from-the-mount-point/" class="next" rel="next" title="Ceph Rados Block Device (RBD) and TRIM">Ceph Rados Block Device (RBD) and TRIM<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.80.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
