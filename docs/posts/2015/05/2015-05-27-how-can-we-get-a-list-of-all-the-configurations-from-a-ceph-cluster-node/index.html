<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>How to fetch the entire list of tunables along with the values for a Ceph cluster node? - The Child is Father of the Man</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="The Child is Father of the Man" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">The Child is Father of the Man</div>
					<div class="logo__tagline">Technical notes... almost</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">Home Page</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about">
				
				<span class="menu__text">About me</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/resume">
				
				<span class="menu__text">Resume</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">How to fetch the entire list of tunables along with the values for a Ceph cluster node?</h1>
			
		</header><div class="content post__content clearfix">
			<p>In many cases we would like to get the active configurations from a Ceph node, either a monitor or an OSD node. A neat feature, I must say, is to probe the administrative socket file to get a listing of all the active configurations, be it on the OSD node or the monitor node.</p>
<p>This comes handy when we have changed a setting and wants to confirm if it had indeed changed or not.</p>
<p>The admin socket file exists for both the monitors and the OSD nodes. The monitor node will have a single admin socket file, while the OSD nodes will have an admin socket for each of the OSDs present on the node.</p>
<ul>
<li>Listing of the admin socket on a monitor node</li>
</ul>
<p>[sourcecode language=&ldquo;bash&rdquo; gutter=&ldquo;false&rdquo;] # ls /var/run/ceph/ -l total 4 srwxr-xr-x. 1 root root 0 May 13 05:13 ceph-mon.hp-m300-2.asok -rw-r&ndash;r&ndash;. 1 root root 7 May 13 05:13 mon.hp-m300-2.pid [/sourcecode]</p>
<ul>
<li>Listing of the admin sockets on an OSD node</li>
</ul>
<p>[sourcecode language=&ldquo;bash&rdquo; gutter=&ldquo;false&rdquo;] # ls -l /var/run/ceph/ total 20 srwxr-xr-x. 1 root root 0 May  8 02:42 ceph-osd.0.asok srwxr-xr-x. 1 root root 0 May 26 11:18 ceph-osd.2.asok srwxr-xr-x. 1 root root 0 May 26 11:18 ceph-osd.3.asok srwxr-xr-x. 1 root root 0 May  8 02:42 ceph-osd.4.asok srwxr-xr-x. 1 root root 0 May 26 11:18 ceph-osd.5.asok -rw-r&ndash;r&ndash;. 1 root root 8 May  8 02:42 osd.0.pid -rw-r&ndash;r&ndash;. 1 root root 8 May 26 11:18 osd.2.pid -rw-r&ndash;r&ndash;. 1 root root 8 May 26 11:18 osd.3.pid -rw-r&ndash;r&ndash;. 1 root root 8 May  8 02:42 osd.4.pid -rw-r&ndash;r&ndash;. 1 root root 8 May 26 11:18 osd.5.pid [/sourcecode]</p>
<p>For example, consider that we have changed the &lsquo;mon_osd_full_ratio&rsquo; value, and need to confirm that the cluster has picked up the change.</p>
<p>We can get a listing of the active configured settings and grep out the setting we are interested in.</p>
<p>[sourcecode language=&ldquo;bash&rdquo; gutter=&ldquo;false&rdquo;]</p>
<p># ceph daemon /var/run/ceph/ceph-mon.*.asok config show</p>
<p>[/sourcecode]</p>
<p>The above command prints out a listing of all the active configurations and their current values. We can easily grep out &lsquo;mon_osd_full_ratio&rsquo; from this list.</p>
<p>[sourcecode language=&ldquo;bash&rdquo; gutter=&ldquo;false&rdquo;]</p>
<p># ceph daemon /var/run/ceph/ceph-mon.*.asok config show | grep mon_osd_full_ratio</p>
<p>[/sourcecode]</p>
<p>On my test cluster, this printed out &lsquo;0.75&rsquo; which is the default setting. The cluster should print out &lsquo;near full&rsquo; warnings once any OSD has reached 75% of its size.</p>
<p>This can be checked by probing the OSD admin socket as well.</p>
<p>NOTE: In case you are probing a particular OSD, please make sure to use the OSD admin socket on the node in which the OSD is. In order to locate the OSD and the node it is on, use :</p>
<p>[sourcecode language=&ldquo;bash&rdquo; gutter=&ldquo;false&rdquo;]</p>
<p># ceph osd tree</p>
<p>[/sourcecode]</p>
<p>Example: We try probing the OSD admin socket on its node, for &lsquo;mon_osd_full_ratio&rsquo; as we did on the monitor. It should return the same value.</p>
<p>[sourcecode language=&ldquo;bash&rdquo; gutter=&ldquo;false&rdquo;]</p>
<p># ceph daemon /var/run/ceph/ceph-osd.5.asok config show | grep mon_osd_full_ratio</p>
<p>[/sourcecode]</p>
<p>NOTE: Another command exists which should print the same configuration settings, but only for OSDs.</p>
<p>[sourcecode language=&ldquo;bash&rdquo; gutter=&ldquo;false&rdquo;]</p>
<p># ceph daemon osd.5 config show</p>
<p>[/sourcecode]</p>
<p>A drawback worth mentioning, this should be executed on the node on which the OSD is present. To find that the OSD to node mapping, use &lsquo;ceph osd tree&rsquo;.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/admin-socket/" rel="tag">admin-socket</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/ceph/" rel="tag">ceph</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/config-show/" rel="tag">config-show</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>




			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 The Child is Father of the Man.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>