<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>"Ceph OSD heartbeats" - arvimal.github.io</title>
    <meta charset="utf-8" />
    <link href="http://fonts.googleapis.com/css?family=Arimo:400,700|Inika" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://arvimal.github.io/theme/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="https://arvimal.github.io/theme/pastie.css" />
    <link href="https://arvimal.github.io/" type="application/atom+xml" rel="alternate" title="arvimal.github.io Atom Feed" />


  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="span8">
<div id="content">
    <div class="header">
        <h1>"Ceph OSD heartbeats"</h1>
    </div>
    <p class="meta"><small><span><a href="https://arvimal.github.io/author/vimal-ar/">Vimal A.R</a> - </span><span>May 09, 2016</span> - <span class="tags"></span></small></p>
        <div class="entry-content">
        <ul>
<li>"ceph"
tags:</li>
<li>"ceph"</li>
<li>"monitors"</li>
</ul>
<hr>
<p>Ceph OSD daemons need to ensure that the neighbouring OSDs are functioning properly so that the cluster remains in a healthy state.</p>
<p>For this, each Ceph OSD process (ceph-osd) sends a heartbeat signal to the neighbouring OSDs. By default, the heartbeat signal is sent every 6 seconds [1], which is configurable of course.</p>
<p>If the heartbeat check from one OSD doesn't hear from the other within the set value for `osd_heartbeat_grace` [2], which is set to 20 seconds by default, the OSD that sends the heartbeat check reports the other OSD (the one that didn't respond within 20 seconds) as down, to the MONs. Once an OSD reports three times that the non-responding OSD is indeed `down`, the MON acknowledges it and mark the OSD as down.</p>
<p>The Monitor will update the Cluster map and send it over to the participating nodes in the cluster.</p>
<p><img alt="OSD-heartbeat-1" src="images/osd-heartbeat-1.png"></p>
<p>When an OSD can't reach another OSD for a heartbeat, it reports the following in the OSD logs:</p>
<blockquote>
<p>osd.510 1497 heartbeat_check: no reply from osd.11 since back 2016-04-28 20:49:42.088802</p>
</blockquote>
<p>In Ceph Jewel, the MONs require a minimum of two ceph OSDs report a specific OSD as down from two nodes which are in different CRUSH subtrees, in order to actually mark the OSD as down. These are controlled by the following tunables :</p>
<p>From 'common/config_opts.h':</p>
<p><strong>[1] OPTION(mon_osd_min_down_reporters, OPT_INT, 2) // number of OSDs from different subtrees who need to report a down OSD for it to count</strong></p>
<p><strong>[2] OPTION(mon_osd_reporter_subtree_level , OPT_STR, "host") // in which level of parent bucket the reporters are counted</strong></p>
<p>Image Courtsey :Â <a href="https://access.redhat.com/documentation/en/red-hat-ceph-storage/version-1.3/red-hat-ceph-storage-13-ceph-configuration-guide/#osd-check-heartbeats">Red Hat Ceph Storage 1.3.2 Configuration guide</a></p>
        </div><!-- /.entry-content -->
</div>
        </div>
        <div class="span3 offset1">
          <div class="well">
            <ul class="nav nav-list">
              <li class="nav-header">Blog</li>
              <li ><a href="https://arvimal.github.io">Index</a></li>
              <li ><a href="https://arvimal.github.io/tags/">Tags</a></li>
              <li ><a href="https://arvimal.github.io/archives/">Archiv</a></li>
              <li class="nav-header">Anderes</li>
              <li><a href="/archives.html">Archives</a></li>
              <li><a href="/categories.html">Categories</a></li>
              <li><a href="/tags.html">Tags</a></li>
            </ul>
          </div><!-- /#menu -->
        </div>
      </div>

      <hr />

      <div class="row">
        <div class="span12">
          <div id="about">
            <p>Proudly powered by <a href="http://twitter.github.com/bootstrap/">bootstrap</a>, <a href="http://docs.notmyidea.org/alexis/pelican/">pelican</a>, <a href="http://python.org">python</a> and <a href="http://www.julo.ch/about/">Alex</a>!</p>
          </div><!-- /#about -->
        </div><!-- /#contentinfo -->
      </div>
    </div>


  </body>
</html>