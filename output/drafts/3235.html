<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>User IDs and User switching in Linux</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">arvimal.blog </a></h1>
                <nav><ul>
                    <li><a href="/category/ceph.html">Ceph</a></li>
                    <li><a href="/category/ceph-programming-python.html">Ceph, Programming, Python</a></li>
                    <li><a href="/category/data-structures-and-algorithms-programming.html">Data Structures and Algorithms, Programming</a></li>
                    <li><a href="/category/data-structures-and-algorithms-programming-python.html">Data Structures and Algorithms, Programming, Python</a></li>
                    <li><a href="/category/linux-programming.html">Linux, Programming</a></li>
                    <li class="active"><a href="/category/misc.html">Misc</a></li>
                    <li><a href="/category/programming.html">Programming</a></li>
                    <li><a href="/category/programming-python.html">Programming, Python</a></li>
                    <li><a href="/category/techno.html">Techno</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/drafts/3235.html" rel="bookmark"
           title="Permalink to User IDs and User switching in Linux">User IDs and User switching in Linux</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-09-16T17:13:00+02:00">
                Published: Sat 16 September 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/arvimal.html">arvimal</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>.</p>

</footer><!-- /.post-info -->      <ul class="simple">
<li>User IDs and linux</li>
</ul>
<div class="section" id="id">
<h2>id</h2>
</div>
<div class="section" id="whoami">
<h2>whoami</h2>
<p>Normal ID range is mentioned in /etc/login.defs</p>
<ul class="simple">
<li>Switching users</li>
</ul>
<p>Two ways to switch:</p>
<p>1.&nbsp;setuid executables (sudo, su, passwd etc..)</p>
<ol class="arabic simple">
<li>setuid() syscall</li>
</ol>
<p>Put in some stuff from man 2 setuid</p>
<p>sudo, su, passwd calls setuid() internally with the uid of the executable.</p>
<p>Try an strace on a sudo command.</p>
<p>#sudo strace -fxvttT sudo cat /etc/shadow &amp;&gt; /tmp/new.txt</p>
<ul class="simple">
<li>Real User ID, Effective User ID, and Saved UID</li>
</ul>
<p>Put stuff from&nbsp;<a class="reference external" href="https://stackoverflow.com/questions/32455684/difference-between-real-user-id-effective-user-id-and-saved-user-id">https://stackoverflow.com/questions/32455684/difference-between-real-user-id-effective-user-id-and-saved-user-id</a> and <tt class="docutils literal">man 2 setuid</tt></p>
<p>Refer&nbsp;7.8 Understanding User IDs and User Switching, in <tt class="docutils literal">How Linux Works 2</tt>.</p>
<p>Refer&nbsp;<a class="reference external" href="http://www.makelinux.net/alp/083">http://www.makelinux.net/alp/083</a></p>
<div class="line-block">
<div class="line">getuid(), geteuid()</div>
<div class="line">From <tt class="docutils literal"><span class="pre">https://stackoverflow.com/questions/32455684/difference-between-real-user-id-effective-user-id-and-saved-user-id</span></tt> :</div>
</div>
<p>~~~</p>
<div class="post-text docutils container">
<p>The distinction between a real and an effective user id is made because you may have the need to temporarily take another user's identity (most of the time, that would be <tt class="docutils literal">root</tt>, but it could be any user). If you only had one user id, then there would be no way of changing back to your original user id afterwards (other than taking your word for granted, and in case you are <tt class="docutils literal">root</tt>, using <tt class="docutils literal">root</tt>'s privileges to change to any user).</p>
<p>So, the real user id is who you really are (the one who owns the process), and the effective user id is what the operating system looks at to make a decision whether or not you are allowed to do something (most of the time, there are some exceptions).</p>
<p>When you log in, the login shell sets both the real and effective user id to the same value (your real user id) as supplied by the password file.</p>
<div class="line-block">
<div class="line">Now, it also happens that you execute a setuid program, and besides running as another user (e.g. <tt class="docutils literal">root</tt>) the setuid program is <em>also</em> supposed to do something on your behalf. How does this work?</div>
<div class="line">After executing the setuid program, it will have your real id (since you're the process owner) and the effective user id of the file owner (for example <tt class="docutils literal">root</tt>) since it is setuid.</div>
</div>
<p>The program does whatever magic it needs to do with superuser privileges and then wants to do something on your behalf. That means, attempting to do something that you shouldn't be able to do <em>should fail</em>. How does it do that? Well, obviously by changing its effective user id to the real user id!</p>
<p>Now that setuid program has no way of switching back since all the kernel knows is your id and... <em>your id</em>. Bang, you're dead.</p>
<p>This is what the saved set-user id is for.</p>
</div>
</div>

    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>